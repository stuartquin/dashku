module.exports =
  name: "Diff Number"
  html: '<div id="message"></div>\n<div id="newNumber"></div>\n<div id="difference">\n  <span id="difference_number"></span>\n    <svg id="arrow_svg"></svg>\n</div>'
  css: '#newNumber {\npadding: 10px;\n  margin-top: 30px;\n  font-size: 45pt;\n  font-weight: bold;\n}\n\n#difference {\n    margin-top: 5%; \n}\n\n#difference span {\n font-size: 30px;\n color: green;\n}\n\n#message {\n color: #999;\n  font-size: 1.1em;\n}'
  script: 'var widget = this.widget;\nvar arrow_svg = null;\n\nrender_arrow = function( percent ) {\n  arrow_svg.selectAll( "polygon" ).remove();\n\n  if ( percent < 0 ){\n    arrow_svg.append( "polygon" )\n    .attr( "points", "0,10 12,25 24,10" )\n    .attr( "fill", "red" );\n    widget.find("#difference_number").css("color", "red");\n  } else {\n     arrow_svg.append( "polygon" )\n    .attr( "points", "0,25 12,10 24,25" )\n    .attr( "fill", "green" );\n    widget.find("#difference_number").css("color", "green");\n  }\n};\n\ncalculate_percentage_diff = function( newNumber, oldNumber ){\n  return Math.round(((newNumber - oldNumber) / oldNumber )*100); \n};\n\n//  <polygon points="0,0 50,50 100,0" style="fill:lime;stroke:purple;stroke-width:1" />\n// This runs when the widget is loaded\nthis.on("load", function(data){\n  head.js("/javascripts/d3.v2.min.js");\n  head.ready(function(){\n      widget.find("#newNumber").text(60);\n      widget.find("#difference_number").text(60);\n\n      // We create the animation canvas here\n      arrow_svg = d3.select( "#arrow_svg" )\n\n      .attr("width",  30 )\n      .attr("height", 30 );\n        render_arrow();\n  });  \n});\n// This runs when the widget receives a transmission\nthis.on("transmission", function(data){\n  widget.find("#newNumber").text(data.newNumber);\n  var diff = 0;\n  if( data.showPercent ){\n    diff = calculate_percentage_diff( data.newNumber, data.oldNumber );\n    widget.find("#difference_number").text(diff + "%");\n  } else {\n    diff = data.newNumber - data.oldNumber;\n    widget.find("#difference_number").text(diff);\n  }\n  \n  if ( data.message ){\n    widget.find( "#message" ).text( data.message ); \n  }\n  \n  render_arrow(diff);\n});'
  json: '{"newNumber": 80,\n  "oldNumber": 74,\n  "showPercent": true,\n  "message": "Company earnings"\n}'
  snapshotUrl: "/images/widgetTemplates/d3gauge.png"
